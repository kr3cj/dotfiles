[[ $- = *i* ]] || return

source "${HOME}/.homesick/repos/homeshick/homeshick.sh"
source "${HOME}/.homesick/repos/homeshick/completions/homeshick-completion.bash"

# TODO: remove after awhile; check if dotfiles_private is using correct url
if grep -q 'url = https.*\|url = ssh.*' ~/.homesick/repos/dotfiles_private/.git/config ; then
  echo "Updating dotfiles_private to use correct url"
  homeshick cd dotfiles_private
  git remote set-url origin git@bitbucket.org:kr3cj/dotfiles_private.git
  cd -
fi

# in case homeshick refresh asks for dotfiles_private repo password
# lpass show --password --clip bitbucket.org
homeshick --quiet refresh

# expensive: ${IS_OSX} && homeshick link dotfiles dotfiles_private
# can take a long time and requires tty?; TODO: try shallow symlinking?
# https://github.com/andsens/homeshick/wiki/Symlinking#shallow-symlinking

${IS_LINUX} || return
homeshick --force link dotfiles dotfiles_private
echo -e "\nPrint any dead links in home directory..."
find ${HOME} -xtype l ! -path "*/Library/*" ! -path "*/.virtualenvs/*" ! -path "*/build/*" \
  -exec echo 'Broken symlink: {}' \;
